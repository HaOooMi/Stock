# è‚¡ç¥¨æœºå™¨å­¦ä¹ é¢„å¤„ç†æµç¨‹

è¿™ä¸ªé¡¹ç›®å®ç°äº†å®Œæ•´çš„è‚¡ç¥¨ç‰¹å¾å·¥ç¨‹åˆ°PCAçŠ¶æ€ç”Ÿæˆçš„æœºå™¨å­¦ä¹ é¢„å¤„ç†æµç¨‹ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
machine learning/
â”œâ”€â”€ feature_engineering.py      # ç‰¹å¾å·¥ç¨‹æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ target_engineering.py       # ç›®æ ‡å˜é‡å·¥ç¨‹æ¨¡å—  
â”œâ”€â”€ pca_state.py                # PCAçŠ¶æ€ç”Ÿæˆæ¨¡å—
â”œâ”€â”€ complete_pipeline.py        # é›†æˆç®¡é“æ¨¡å—
â”œâ”€â”€ run_complete_pipeline.py    # å®Œæ•´æµç¨‹è¿è¡Œè„šæœ¬
â”œâ”€â”€ run_pca_state.py            # PCAçŠ¶æ€ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ test_pca_state.py           # PCAæ¨¡å—æµ‹è¯•è„šæœ¬
â””â”€â”€ ML output/                  # æœºå™¨å­¦ä¹ è¾“å‡ºç›®å½•
    â”œâ”€â”€ models/                 # è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
    â”œâ”€â”€ states/                 # PCAçŠ¶æ€è¡¨ç¤ºæ–‡ä»¶
    â”œâ”€â”€ scaled_features.csv     # æ ‡å‡†åŒ–ç‰¹å¾æ•°æ®
    â”œâ”€â”€ final_feature_list.txt  # æœ€ç»ˆç‰¹å¾åˆ—è¡¨
    â”œâ”€â”€ target_variables.csv    # ç›®æ ‡å˜é‡æ•°æ®
    â”œâ”€â”€ target_labels_*.csv     # åˆ†ç±»æ ‡ç­¾æ•°æ®
    â””â”€â”€ pipeline_summary.txt    # æµç¨‹æ‘˜è¦æŠ¥å‘Š
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: è¿è¡Œå®Œæ•´æµç¨‹ï¼ˆæ¨èï¼‰

è¿è¡Œå®Œæ•´çš„é¢„å¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬ç‰¹å¾å·¥ç¨‹ã€ç›®æ ‡å·¥ç¨‹å’ŒPCAçŠ¶æ€ç”Ÿæˆï¼š

```bash
python run_complete_pipeline.py
```

### æ–¹æ³•2: åˆ†æ­¥æ‰§è¡Œ

å¦‚æœéœ€è¦åˆ†æ­¥æ‰§è¡Œæˆ–è°ƒè¯•ç‰¹å®šæ¨¡å—ï¼š

#### æ­¥éª¤1: ç‰¹å¾å·¥ç¨‹
```bash
python feature_engineering.py
```

#### æ­¥éª¤2: ç›®æ ‡å˜é‡å·¥ç¨‹
```bash
python target_engineering.py
```

#### æ­¥éª¤3: PCAçŠ¶æ€ç”Ÿæˆ
```bash
python run_pca_state.py
```

### æ–¹æ³•3: æµ‹è¯•PCAæ¨¡å—

åœ¨ä½¿ç”¨çœŸå®æ•°æ®å‰æµ‹è¯•PCAåŠŸèƒ½ï¼š

```bash
python test_pca_state.py
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

### ç‰¹å¾æ–‡ä»¶
- `scaled_features.csv`: æ ‡å‡†åŒ–åçš„ç‰¹å¾æ•°æ®ï¼Œç”¨äºæœºå™¨å­¦ä¹ è®­ç»ƒ
- `final_feature_list.txt`: ç»è¿‡é‡è¦æ€§ç­›é€‰çš„æœ€ç»ˆç‰¹å¾åˆ—è¡¨

### ç›®æ ‡æ–‡ä»¶  
- `target_variables.csv`: æœªæ¥æ”¶ç›Šç‡ç­‰è¿ç»­å‹ç›®æ ‡å˜é‡
- `target_labels_binary.csv`: äºŒåˆ†ç±»æ ‡ç­¾ï¼ˆæ¶¨/è·Œï¼‰
- `target_labels_quantile.csv`: å¤šåˆ†ç±»æ ‡ç­¾ï¼ˆåˆ†ä½æ•°ï¼‰

### PCAæ–‡ä»¶
- `models/pca_model_*.pkl`: è®­ç»ƒå¥½çš„PCAæ¨¡å‹
- `states/pca_states_train_*.npy`: è®­ç»ƒé›†çš„PCAçŠ¶æ€è¡¨ç¤º
- `states/pca_states_test_*.npy`: æµ‹è¯•é›†çš„PCAçŠ¶æ€è¡¨ç¤º

### æ—¥å¿—å’Œæ‘˜è¦
- `*.log`: å„æ¨¡å—çš„è¿è¡Œæ—¥å¿—
- `pipeline_summary.txt`: å®Œæ•´æµç¨‹çš„æ‘˜è¦æŠ¥å‘Š

## âš™ï¸ é…ç½®å‚æ•°

### ç‰¹å¾å·¥ç¨‹å‚æ•°
- `max_horizon`: æœ€å¤§é¢„æµ‹çª—å£ï¼ˆé»˜è®¤10å¤©ï¼‰
- `importance_threshold`: ç‰¹å¾é‡è¦æ€§é˜ˆå€¼ï¼ˆé»˜è®¤0.01ï¼‰
- `correlation_threshold`: ç›¸å…³æ€§å»é‡é˜ˆå€¼ï¼ˆé»˜è®¤0.95ï¼‰

### ç›®æ ‡å·¥ç¨‹å‚æ•°  
- `future_horizons`: æœªæ¥é¢„æµ‹æœŸé—´ï¼ˆé»˜è®¤[1, 3, 5, 10]å¤©ï¼‰
- `quantile_bins`: åˆ†ä½æ•°åˆ†ç±»æ•°é‡ï¼ˆé»˜è®¤5ï¼‰

### PCAå‚æ•°
- `n_components`: ç›®æ ‡è§£é‡Šæ–¹å·®ï¼ˆé»˜è®¤0.9ï¼‰
- `train_ratio`: è®­ç»ƒæ•°æ®æ¯”ä¾‹ï¼ˆé»˜è®¤0.8ï¼‰
- ä¸»æˆåˆ†æ•°é‡çº¦æŸï¼šåŸå§‹ç‰¹å¾æ•°çš„1/6åˆ°1/3

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### Pythonç‰ˆæœ¬
- Python 3.8+

### å¿…éœ€åŒ…
```bash
pip install pandas numpy scikit-learn akshare influxdb-client
```

### å¯é€‰åŒ…ï¼ˆç”¨äºå¯è§†åŒ–å’Œé«˜çº§åˆ†æï¼‰
```bash
pip install matplotlib seaborn plotly
```

## ğŸ“ˆ ä½¿ç”¨æµç¨‹

1. **æ•°æ®å‡†å¤‡**: ç¡®ä¿InfluxDBä¸­æœ‰è‚¡ç¥¨å†å²æ•°æ®
2. **è¿è¡Œæµç¨‹**: æ‰§è¡Œ `python run_complete_pipeline.py`
3. **æ£€æŸ¥ç»“æœ**: æŸ¥çœ‹ `ML output/` ç›®å½•ä¸‹çš„è¾“å‡ºæ–‡ä»¶
4. **å¼€å§‹å»ºæ¨¡**: ä½¿ç”¨ç”Ÿæˆçš„ç‰¹å¾å’Œç›®æ ‡æ•°æ®è¿›è¡Œæœºå™¨å­¦ä¹ å»ºæ¨¡

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼ºå°‘è¾“å…¥æ•°æ®**
   - ç¡®ä¿InfluxDBè¿æ¥æ­£å¸¸
   - æ£€æŸ¥è‚¡ç¥¨æ•°æ®æ˜¯å¦å·²ä¸‹è½½

2. **å†…å­˜ä¸è¶³**
   - å‡å°‘å¤„ç†çš„è‚¡ç¥¨æ•°é‡
   - é™ä½ç‰¹å¾ç»´åº¦
   - åˆ†æ‰¹å¤„ç†æ•°æ®

3. **PCAæˆåˆ†è¿‡å°‘/è¿‡å¤š**
   - è°ƒæ•´ `n_components` å‚æ•°
   - æ£€æŸ¥åŸå§‹ç‰¹å¾è´¨é‡
   - è€ƒè™‘ç‰¹å¾é¢„ç­›é€‰

### è°ƒè¯•æŠ€å·§

- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯å•ä¸ªæ¨¡å—åŠŸèƒ½
- æ£€æŸ¥ä¸­é—´è¾“å‡ºæ–‡ä»¶çš„æ•°æ®è´¨é‡

## ğŸ“ å¼€å‘è¯´æ˜

### æ¨¡å—èŒè´£

- `feature_engineering.py`: è´Ÿè´£ä»åŸå§‹æ•°æ®ç”Ÿæˆå’Œç­›é€‰ç‰¹å¾
- `target_engineering.py`: è´Ÿè´£ç”Ÿæˆå„ç§ç±»å‹çš„ç›®æ ‡å˜é‡
- `pca_state.py`: è´Ÿè´£PCAé™ç»´å’ŒçŠ¶æ€è¡¨ç¤ºç”Ÿæˆ
- `complete_pipeline.py`: è´Ÿè´£æ¨¡å—é—´çš„é›†æˆå’Œæµç¨‹æ§åˆ¶

### æ‰©å±•å»ºè®®

1. **æ·»åŠ æ–°ç‰¹å¾**: åœ¨ `feature_engineering.py` ä¸­æ‰©å±•ç‰¹å¾è®¡ç®—å‡½æ•°
2. **è‡ªå®šä¹‰ç›®æ ‡**: åœ¨ `target_engineering.py` ä¸­æ·»åŠ æ–°çš„ç›®æ ‡å˜é‡ç±»å‹
3. **æ”¹è¿›PCA**: è€ƒè™‘ä½¿ç”¨IncrementalPCAæˆ–KernelPCA
4. **å¹¶è¡Œå¤„ç†**: ä½¿ç”¨multiprocessingåŠ é€Ÿå¤§æ•°æ®é›†å¤„ç†

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ‘¥ ä½œè€…

Assistant - AIç¼–ç¨‹åŠ©æ‰‹

---

ğŸ’¡ **æç¤º**: é¦–æ¬¡è¿è¡Œå»ºè®®ä½¿ç”¨ `test_pca_state.py` éªŒè¯ç¯å¢ƒé…ç½®ï¼Œç„¶åå†è¿è¡Œå®Œæ•´æµç¨‹ã€‚